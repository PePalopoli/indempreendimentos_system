{% set menu_pagina = empreendimento.slug %}
{% extends 'front/layout.twig' %}

{% block content %}

<section class="empreendimento-banner">
    <div class="container-fluid mx-0 px-0">
        <img src="{{path('imagem', {'path': 'empreendimentos', 'imagem': empreendimento.img_capa, 'w': 1920, 'h': 500, 'fit': 'crop'})}}" alt="Empreendimento" class="img-fluid w-100" loading="lazy">        
        {# <source srcset="{{path('imagem', {'path': 'empreendimentos', 'imagem': empreendimento.img_capa})}}" type="image/webp" alt="Empreendimento" class="img-fluid w-100"> #}
    </div>
</section>

<section class="empreendimento-interno-abertura py-5">
    <div class="container">
        <div class="row justify-content-center gap-3">

            <div class="cada-bloco" style="background-color: {{empreendimento.cor_hex}};">
                {{empreendimento.titulo_etapa}}
            </div>

            <div class="cada-bloco" style="text-transform: uppercase;">
                {{empreendimento.cidade_estado}}
            </div>

            <div class="img-logo-residencial py-5 d-flex justify-content-center">
                <img src="{{path('imagem', {'path': 'empreendimentos', 'imagem': empreendimento.logo_empreendimento})}}" alt="Logo Residencial" class="img-fluid" loading="lazy">
            </div>


        </div>
    </div>
</section>

<section class="empreendimento-interno-chamada py-5">
    <div class="container">
        <div class="row">
            {{empreendimento.descricao|raw}}
        </div>
    </div>
</section>




<section class="empreendimento-info py-5">
    <div class="container">
        <h2 class="text-center mb-5 section-title py-4">Informações do empreendimento:</h2>

        <div class="row g-4 mb-5 {% if empreendimentos_beneficios|length > 3 %} justify-content-center {% endif %}">

        {% for item in empreendimentos_beneficios %}

            <div class="col-lg-3 col-md-6 col-6 cada-bloco-conteudo-residencial" >
                <div class="info-card h-100 d-flex flex-column align-items-center justify-content-center text-center" style="background-color: {{item.cor_hex}};">
                    <div class="icon mb-3">
                        {{item.svg_code|raw}}
                    </div>
                    <span class="info-text">{{item.valor_personalizado|raw}}</span>
                </div>
            </div>
        {% endfor %}






            
        </div>

        {% if empreendimento.acesso_facil %}

        <div class="row">
            <div class="col-12">
                <div class="access-info text-center">
                    <h3 class="access-title  pb-5">Fácil acesso aos principais pontos da cidade:</h3>
                    <div class="row justify-content-center">
                        <div class="col-md-6 col-lg-4">
                            <div class="access-column">
                                <span class="access-item d-block">Supermercados</span>
                                <span class="access-item d-block">Escolas</span>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="access-column">
                                <span class="access-item d-block">Restaurantes</span>
                                <span class="access-item d-block">Academias</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

    </div>
</section>

<section class="planta-section">
    <div class="container">
        <div class="row comeco-planta">

            {% for item in empreendimentos_plantas %}
                <div class="col-12 cada-planta text-center">
                    <div class="text-planta">
                        <h2 class="">{{item.titulo_principal|raw}}</h2>
                        <p>{{item.sub_titulo|raw}}</p>
                    </div>
                    <div class="img-planta">
                        <img src="{{path('imagem', {'path': 'plantas', 'imagem': item.imagem})}}" alt="" class="img-fluid" loading="lazy">
                    </div>
                </div>
            {% endfor %}

            
        </div>
    </div>
</section>

{% if galeria|length > 0 %}


<section class="galeria-section py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5">Confira a galeria de fotos</h2>
            </div>
        </div>
        
        <!-- Imagem Principal -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="main-image-container text-center position-relative">
                    <img src="{{path('imagem', {'path': 'empreendimentos_galeria', 'imagem': galeria[0].imagem})}}" alt="Imagem Principal" class="img-fluid main-gallery-image" id="mainImage" loading="lazy">
                    
                    <!-- Setas de navegação -->
                    <button class="gallery-nav-btn gallery-prev" onclick="previousImage()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="gallery-nav-btn gallery-next" onclick="nextImage()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Thumbnails -->
        <div class="row">
            <div class="col-12">
                <div class="thumbnails-wrapper">
                    <div class="thumbnails-container">
                        {% for item in galeria %}
                        <div class="thumbnail-item">
                            <img src="{{path('imagem', {'path': 'empreendimentos_galeria', 'imagem': item.imagem})}}" alt="Galeria {{loop.index}}" class="img-fluid thumbnail-image {% if loop.index == 0 %} active" {% endif %} data-index="{{loop.index}}" onclick="changeMainImage(this.src, this, {{loop.index}})">
                        </div>
                        {% endfor %}                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript para controlar a galeria -->
    <script>
        let currentImageIndex = 0;
        let autoSlideInterval;
        let isAutoPlaying = true;
        
        const images = [
            {% for item in galeria %}
            '{{path('imagem', {'path': 'empreendimentos_galeria', 'imagem': item.imagem})}}',
            {% endfor %}
        ];

        function changeMainImage(src, element, index) {
            const mainImage = document.getElementById('mainImage');
            
            // Para o autoplay temporariamente
            stopAutoSlide();
            
            // Adiciona efeito de fade
            mainImage.style.opacity = '0';
            
            setTimeout(() => {
                mainImage.src = src;
                currentImageIndex = index;
                updateActiveThumbnail();
                scrollToActiveThumbnail();
                
                // Restaura a opacidade
                mainImage.style.opacity = '1';
                
                // Reinicia o autoplay após 5 segundos
                setTimeout(() => {
                    startAutoSlide();
                }, 5000);
            }, 150);
        }

        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            updateMainImage();
        }

        function previousImage() {
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            updateMainImage();
        }

        function updateMainImage() {
            const mainImage = document.getElementById('mainImage');
            
            // Efeito de transição
            mainImage.style.opacity = '0';
            
            setTimeout(() => {
                mainImage.src = images[currentImageIndex];
                updateActiveThumbnail();
                scrollToActiveThumbnail();
                
                mainImage.style.opacity = '1';
            }, 150);
        }

        function updateActiveThumbnail() {
            const thumbnails = document.querySelectorAll('.thumbnail-image');
            
            // Atualiza as thumbnails
            thumbnails.forEach((thumb, index) => {
                thumb.classList.toggle('active', index === currentImageIndex);
            });
        }

        function scrollToActiveThumbnail() {
            const activeThumb = document.querySelector('.thumbnail-image.active');
            const container = document.querySelector('.thumbnails-container');
            
            if (activeThumb && container) {
                const containerWidth = container.offsetWidth;
                const thumbLeft = activeThumb.offsetLeft;
                const thumbWidth = activeThumb.offsetWidth;
                
                // Calcula a posição de scroll para centralizar a thumbnail ativa
                const scrollLeft = thumbLeft - (containerWidth / 2) + (thumbWidth / 2);
                
                container.scrollTo({
                    left: scrollLeft,
                    behavior: 'smooth'
                });
            }
        }

        function startAutoSlide() {
            if (isAutoPlaying) {
                autoSlideInterval = setInterval(() => {
                    nextImage();
                }, 4000); // Troca a cada 4 segundos
            }
        }

        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }

        function pauseAutoSlide() {
            isAutoPlaying = false;
            stopAutoSlide();
        }

        function resumeAutoSlide() {
            isAutoPlaying = true;
            startAutoSlide();
        }

        // Eventos para pausar/retomar autoplay
        document.addEventListener('DOMContentLoaded', function() {
            const gallerySection = document.querySelector('.galeria-section');
            
            gallerySection.addEventListener('mouseenter', pauseAutoSlide);
            gallerySection.addEventListener('mouseleave', resumeAutoSlide);
            
            // Inicia o autoplay
            startAutoSlide();
        });

        // Adiciona suporte para teclas do teclado
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') {
                stopAutoSlide();
                previousImage();
                setTimeout(() => {
                    startAutoSlide();
                }, 5000);
            } else if (e.key === 'ArrowRight') {
                stopAutoSlide();
                nextImage();
                setTimeout(() => {
                    startAutoSlide();
                }, 5000);
            }
        });

        // Para o autoplay quando a página não está visível
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                pauseAutoSlide();
            } else {
                resumeAutoSlide();
            }
        });
    </script>
</section>
{% endif %}

{% if empreendimentos_tour_botoes|length > 0 %}
<section class="tour-virtual-section">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center text-tour-virtual">
                <h2 >Tour Virtual</h2>
                <p>Faça um <b>tour virtual</b> pelo Residencial das Palmeiras</p>
            </div>
            <div class="lista-btn-tour d-flex justify-content-center gap-4 flex-wrap">
                {% for item in empreendimentos_tour_botoes %}
                <div class="btn-tour">
                    <a href="{{item.url_destino}}" target="_blank" class="tour-btn" style="background-color: {{item.cor_fundo}};color: {{item.cor_texto}};">
                        <i class="{{item.icone_class}}"></i> {{item.texto_botao|raw}}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{% include  'containers/empreendimentos_interno.twig' %}
{% include  'containers/contato_empreendimentos_internas.twig' %}


{% endblock %}